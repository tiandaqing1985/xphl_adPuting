<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <th:block th:include="include :: header('汇总情况')"/>
</head>
<body class="gray-bg">
<div class="container-div">


    <div class="row">
        <div class="col-sm-12 search-collapse">
            <form id="formId">
                <div class="select-list">
                    <ul>
                        <li>
                            期间：<input type="text" name="quarter"/>
                        </li>

                        <li>
                            <a class="btn btn-primary btn-rounded btn-sm" onclick="mySearch(3)"><i
                                    class="fa fa-search"></i>&nbsp;搜索</a>
                            <a class="btn btn-warning btn-rounded btn-sm"
                               onclick="$.form.reset('formId3')"><i
                                    class="fa fa-refresh"></i>&nbsp;重置</a>
                            <a class="btn btn-primary btn-rounded btn-sm"
                               onclick="myExportExcel('3')"><i class="fa fa-download"></i> 导出</a>
                        </li>
                    </ul>
                </div>
            </form>
        </div>
        <div class="col-sm-12 select-table table-striped">
            <div class="btn-group-sm" role="group" id="toolbar3">
                <a class="btn btn-danger multiple"
                   onclick="removeAll()">
                    <i class="fa fa-remove"></i> 删除
                </a>
                <a class="btn btn-primary" onclick="startPlan()">
                    <i class="fa fa-upload"></i> 启用
                </a>
                <a class="btn btn-info" onclick="$.table.refresh()" style="float: right">
                    <i class="fa fa-refresh"></i> 刷新
                </a>
                <a class="btn btn-success" onclick="showField()" style="float: right">
                    <i class="fa fa-plus"></i> 显示方案
                </a>
            </div>
            <div class="col-sm-12 select-table table-striped" id="fieldDiv" style="display: none">
                <div class="row">
                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="campaignId">广告组ID
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="campaignName">广告组名称
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="adId">广告ID
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="name">广告名称
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="deliveryRange">投放范围
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="budgetMode">预算类型
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="budget">预算金额
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="startTime">开始时间
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="endTime">结束时间
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="pricing">出价类型
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="bid">出价金额
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="scheduleType">广告投放类型
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="scheduleTime">广告投放时段
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="flowControlMode">投放速度类型
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="openUrl">应用直达链接
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="downloadType">应用下载方式
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="externalUrl">广告落地页链接
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="downloadUrl">广告应用下载链接
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="appType">应用下载类型
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="adPackage">广告应用下载包名
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="hideIfConverted">过滤已转化用户类型
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="cpaBid">ocpm广告转化出价
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="convertId">转化ID
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="retargetingTagsInclude">定向人群包列表
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="retargetingTagsExclude">排除人群包列表
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="gender">受众性别
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="age">受众年龄区间
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="carrier">运营商
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="ac">网络类型
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="articleCategory">受众文章分类
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="platform">受众平台
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="district">地域类型
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="city">地域定向城市或者区县列表
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="adTag">兴趣分类
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="interestTags">兴趣关键词
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="appBehaviorTarget">APP行为定向
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="appCategory">APP行为按分类集合
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="appIds">APP行为定向APP集合
                    </div>

                    <div class="col-sm-1"><input type="checkbox" class="field" checked="checked"
                                                 value="remark">备注
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <input type="checkbox" name="allSelect" checked="checked" >全选
                        <button class="btn btn-primary " type="button"
                                onclick="saveFields()"><i class="fa fa-check"></i>&nbsp;保存
                        </button>
                    </div>
                    <div class="col-sm-5" id="fieldBtnGroup">

                    </div>
                </div>
            </div>
            <table id="bootstrap-table" data-mobile-responsive="true"></table>
        </div>
    </div>

</div>
<div th:include="include :: footer"></div>
<script th:inline="javascript">
    var prefix3 = ctx + "today/ad";
    var prefix4 = ctx + "today/show";
    var prefix5 = ctx + "today/creativity";

    var editFlag = [[${@permission.hasPermi('today:ad:edit')}]];
    var removeFlag = [[${@permission.hasPermi('today:ad:remove')}]];
    var deliveryRangeDatas = [[${@dict.getType('th_ad_delivery_range')}]];
    var budgetModeDatas = [[${@dict.getType('th_ad_budget_mode')}]];
    var pricingDatas = [[${@dict.getType('th_ad_pricing')}]];
    var scheduleTypeDatas = [[${@dict.getType('th_ad_schedule_type')}]];
    var flowControlModeDatas = [[${@dict.getType('th_ad_flow_control_mode')}]];
    var appTypeDatas = [[${@dict.getType('th_ad_app_type')}]];
    var hideIfConvertedDatas = [[${@dict.getType('th_ad_hide_if_converted')}]];
    var genderDatas = [[${@dict.getType('th_ad_gender')}]];
    var ageDatas = [[${@dict.getType('th_ad_age')}]];
    var carrierDatas = [[${@dict.getType('th_ad_carrier')}]];
    var acDatas = [[${@dict.getType('th_ad_ac')}]];
    var adStatus = [[${@dict.getType('th_ad_status')}]];
    var articleCategoryDatas = [[${@dict.getType('th_ad_article_category')}]];
    var platformDatas = [[${@dict.getType('th_ad_platform')}]];
    var appBehaviorTargetDatas = [[${@dict.getType('th_ad_behavior_target')}]];
    var districtDatas = [[${@dict.getType('th_ad_district')}]];

    var showFieldCase = {};
    
    function useShowFieldCase(name) {
        var fields = showFieldCase[name];
        $('.field:checkbox:checked').prop("checked",false);
        $.each(isShow,function(name,value){
            isShow[name] = false;
        });
        fields.split(",").forEach(function (item,index) {
            $(".field:checkbox[value='" + item + "']").prop("checked",true);
            isShow[item] = true;
        });
        $.table.destroy();
        options3Initfun();
        $.table.init(options3);

    }

    function initFieldGroup() {
        showFieldCase = {};
        var config = {
            url: prefix4 + "/list",
            type: "post",
            dataType: "json",
            data: {},
            success: function(result) {
                var html = [];
                result.forEach(function(item,index){
                    showFieldCase[item.id] = item.context;
                    html.push("<button class='btn btn-danger ' type='button' onclick='useShowFieldCase("+item.id+")'>&nbsp;"+item.name+"</button>&nbsp;")
                });
                $("#fieldBtnGroup").html(html.join(""));
            }
        };
        $.ajax(config);
    }

    function saveFields() {

        var data = {};
        var context;
        $.each($('.field:checkbox:checked'), function (index, val) {
            var name = $(this).val();
            if ($.common.isEmpty(context)) {
                context = name;
            }else{
                context = context + "," + name;
            }
        });
        data["context"] = context;
        $.operate.submit(prefix4 + "/add", "post", "json", data, function (result) {
            initFieldGroup();
        });
    }

    function showField() {
        var state = $("#fieldDiv").attr("style");
        if (state == "display:block") {
            $("#fieldDiv").attr("style", "display:none");//隐藏div
        } else {
            $("#fieldDiv").attr("style", "display:block");//显示div
            initFieldGroup();
        }
    }

    function startPlan() {
        var rows = $.common.isEmpty($.table._option.uniqueId) ? $.table.selectFirstColumns() : $.table.selectColumns($.table._option.uniqueId);
        if (rows.length == 0) {
            $.modal.alertWarning("请至少选择一条记录");
            return;
        }
        $.modal.confirm("确认要启用选中的" + rows.length + "条计划吗?", function () {
            var url = prefix3 + "/updatePlan"
            var data = {"ids": rows.join()};
            $.operate.submit(url, "post", "json", data);
        });
    }

    var isShow = {
        "campaignId":true,

        "campaignName":true,

        "adId":true,

        "name":true,

        "deliveryRange":true,

        "budgetMode":true,

        "budget":true,

        "startTime":true,

        "endTime":true,

        "pricing":true,

        "bid":true,

        "scheduleType":true,

        "scheduleTime":true,

        "flowControlMode":true,

        "openUrl":true,

        "downloadType":true,

        "externalUrl":true,

        "downloadUrl":true,

        "appType":true,

        "adPackage":true,

        "hideIfConverted":true,

        "cpaBid":true,

        "convertId":true,

        "retargetingTagsInclude":true,

        "retargetingTagsExclude":true,

        "gender":true,

        "age":true,

        "carrier":true,

        "ac":true,

        "articleCategory":true,

        "platform":true,

        "district":true,

        "city":true,

        "adTag":true,

        "interestTags":true,

        "appBehaviorTarget":true,

        "appCategory":true,

        "appIds":true,

        "remark":true
    };

    var options3;
    function options3Initfun() {
        options3 = {
            url: prefix3 + "/list",
            createUrl: prefix3 + "/add",
            updateUrl: prefix3 + "/edit/{id}",
            removeUrl: prefix3 + "/remove",
            exportUrl: prefix3 + "/export",
            queryParams: {"updateFlag": "1"},
            modalName: "广告计划",
            showSearch: false,
            showRefresh: false,
            showToggle: false,
            showColumns: false,
            showExport: false,
            fixedColumns: true,
            fixedNumber: 5,
            pagination: false,
            onDblClickRow: function (row) {
                $.modal.openTab('广告创意', prefix5+'/'+row.id);
            },
            columns: [{
                checkbox: true
            },
                {
                    field: 'id',
                    title: 'ID',
                    visible: false
                },
                {
                    title: '操作',
                    align: 'center',
                    formatter: function (value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-success btn-xs ' + editFlag + '" href="javascript:void(0)" onclick="$.operate.edit(\'' + row.id + '\')"><i class="fa fa-edit"></i>编辑</a> ');
                        actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="javascript:void(0)" onclick="remove(\'' + row.id + '\')"><i class="fa fa-remove"></i>删除</a>');
                        return actions.join('');
                    }
                },
                {
                    field: 'status',
                    title: '状态',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(adStatus, value);
                    }
                },
                {
                    field: 'advertiserId',
                    title: '广告主ID'
                },
                {
                    field: 'advertiserName',
                    title: '广告主名称'
                },
                {
                    field: 'campaignId',
                    title: '广告组ID',
                    visible: isShow["campaignId"]
                },
                {
                    field: 'campaignName',
                    title: '广告组名称',
                    visible: isShow["campaignName"]
                },
                {
                    field: 'adId',
                    title: '广告ID',
                    visible: isShow["adId"]
                },
                {
                    field: 'name',
                    title: '广告名称',
                    visible: isShow["name"]
                },
                {
                    field: 'deliveryRange',
                    title: '投放范围',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(deliveryRangeDatas, value);
                    },
                    visible: isShow["deliveryRange"]
                },
                {
                    field: 'budgetMode',
                    title: '预算类型',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(budgetModeDatas, value);
                    },
                    visible: isShow["budgetMode"]
                },
                {
                    field: 'budget',
                    title: '预算金额',
                    visible: isShow["budget"]
                },
                {
                    field: 'startTime',
                    title: '开始时间',
                    visible: isShow["startTime"]
                },
                {
                    field: 'endTime',
                    title: '结束时间',
                    visible: isShow["endTime"]
                },
                {
                    field: 'pricing',
                    title: '出价类型',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(pricingDatas, value);
                    },
                    visible: isShow["pricing"]
                },
                {
                    field: 'bid',
                    title: '出价金额',
                    visible: isShow["bid"]
                },
                {
                    field: 'scheduleType',
                    title: '广告投放类型',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(scheduleTypeDatas, value);
                    },
                    visible: isShow["scheduleType"]
                },
                {
                    field: 'scheduleTime',
                    title: '广告投放时段',
                    visible: isShow["scheduleTime"]
                },
                {
                    field: 'flowControlMode',
                    title: '投放速度类型',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(flowControlModeDatas, value);
                    },
                    visible: isShow["flowControlMode"]
                },
                {
                    field: 'openUrl',
                    title: '应用直达链接',
                    visible: isShow["openUrl"]
                },
                {
                    field: 'downloadType',
                    title: '应用下载方式',
                    visible: isShow["downloadType"]
                },
                {
                    field: 'externalUrl',
                    title: '广告落地页链接',
                    visible: isShow["externalUrl"]
                },
                {
                    field: 'downloadUrl',
                    title: '广告应用下载链接',
                    visible: isShow["downloadUrl"]
                },
                {
                    field: 'appType',
                    title: '应用下载类型',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(appTypeDatas, value);
                    },
                    visible: isShow["appType"]
                },
                {
                    field: 'adPackage',
                    title: '广告应用下载包名',
                    visible: isShow["adPackage"]
                },
                {
                    field: 'hideIfConverted',
                    title: '过滤已转化用户类型',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(hideIfConvertedDatas, value);
                    },
                    visible: isShow["hideIfConverted"]
                },
                {
                    field: 'cpaBid',
                    title: 'ocpm广告转化出价',
                    visible: isShow["cpaBid"]
                },
                {
                    field: 'convertId',
                    title: '转化ID',
                    visible: isShow["convertId"]
                },
                {
                    field: 'retargetingTagsInclude',
                    title: '定向人群包列表',
                    visible: isShow["retargetingTagsInclude"]
                },
                {
                    field: 'retargetingTagsExclude',
                    title: '排除人群包列表',
                    visible: isShow["retargetingTagsExclude"]
                },
                {
                    field: 'gender',
                    title: '受众性别',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(genderDatas, value);
                    },
                    visible: isShow["gender"]
                },
                {
                    field: 'age',
                    title: '受众年龄区间',
                    formatter: function (value, row, index) {
                        if ($.common.isEmpty(value)) {
                            return undefined;
                        }
                        var val = value.split(",");
                        val.forEach(function (value1, index1, array) {
                            array[index1] = $.table.selectDictLabel(ageDatas, value1);
                        })
                        return val.join(",");
                    },
                    visible: isShow["age"]
                },
                {
                    field: 'carrier',
                    title: '运营商',
                    formatter: function (value, row, index) {
                        if ($.common.isEmpty(value)) {
                            return undefined;
                        }
                        var val = value.split(",");
                        val.forEach(function (value1, index1, array) {
                            array[index1] = $.table.selectDictLabel(carrierDatas, value1);
                        })
                        return val.join(",");
                    },
                    visible: isShow["carrier"]
                },
                {
                    field: 'ac',
                    title: '网络类型',
                    formatter: function (value, row, index) {
                        if ($.common.isEmpty(value)) {
                            return undefined;
                        }
                        var val = value.split(",");
                        val.forEach(function (value1, index1, array) {
                            array[index1] = $.table.selectDictLabel(acDatas, value1);
                        })
                        return val.join(",");
                    },
                    visible: isShow["ac"]
                },
                {
                    field: 'articleCategory',
                    title: '受众文章分类',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(articleCategoryDatas, value);
                    },
                    visible: isShow["articleCategory"]
                },
                {
                    field: 'platform',
                    title: '受众平台',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(platformDatas, value);
                    },
                    visible: isShow["platform"]
                },
                {
                    field: 'district',
                    title: '地域类型',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(districtDatas, value);
                    },
                    visible: isShow["district"]
                },
                {
                    field: 'city',
                    title: '地域定向城市或者区县列表',
                    formatter: function (value, row, index) {
                        if ($.common.isEmpty(value)) {
                            return undefined;
                        }
                        var val = value.split(",");
                        val.forEach(function (value1, index1, array) {
                            array[index1] = $.table.selectDictLabel(cityDatas, value1);
                        })
                        return val.join(",");
                    },
                    visible: isShow["city"]
                },
                {
                    field: 'adTag',
                    title: '兴趣分类',
                    visible: isShow["adTag"]
                },
                {
                    field: 'interestTags',
                    title: '兴趣关键词',
                    visible: isShow["interestTags"]
                },
                {
                    field: 'appBehaviorTarget',
                    title: 'APP行为定向',
                    formatter: function (value, row, index) {
                        return $.table.selectDictLabel(appBehaviorTargetDatas, value);
                    },
                    visible: isShow["appBehaviorTarget"]
                },
                {
                    field: 'appCategory',
                    title: 'APP行为按分类集合',
                    visible: isShow["appCategory"]
                },
                {
                    field: 'appIds',
                    title: 'APP行为定向,APP集合',
                    visible: isShow["appIds"]
                },
                {
                    field: 'remark',
                    title: '备注',
                    formatter: function (value, row, index) {
                        return $.table.tooltip(value);
                    },
                    visible: isShow["remark"]
                }]
        };
    }

    $(function () {
        options3Initfun();
        $.table.init(options3);
        $(".field").change(function () {
            var o = $(this).prop("checked");
            var field = $(this).attr("value");
            if (o) {
                isShow[field] = true;
                $.table.showColumn(field)
            } else {
                isShow[field] = false;
                $.table.hideColumn(field)
            }
        });
        $("input[name='allSelect']").change(function () {
            var o = $(this).prop("checked");
            $(".field").prop("checked",o);
            $.each(isShow,function(name,value){
                isShow[name] = o;
            });
            $.table.destroy();
            options3Initfun();
            $.table.init(options3);
        });
    });

    function removeAll(){
        $.operate.removeAll();
    }

    function remove(id){
        $.operate.remove(id);
    }


</script>
</body>
<!-- 导入区域 -->
<script id="importTpl" type="text/template">
    <form enctype="multipart/form-data" class="mt20 mb10">
        <div class="col-xs-offset-1">
            <input type="file" id="file" name="file"/>
            <div class="mt10 pt5">
                <input type="checkbox" id="updateSupport" name="updateSupport" title="如果登录账户已经存在，更新这条数据。"> 是否更新已经存在的用户数据
                &nbsp; <a onclick="$.table.importTemplate()" class="btn btn-default btn-xs"><i
                    class="fa fa-file-excel-o"></i> 下载模板</a>
            </div>
            <font color="red" class="pull-left mt10">
                提示：仅允许导入“xls”或“xlsx”格式文件！
            </font>
        </div>
    </form>
</script>
</html>